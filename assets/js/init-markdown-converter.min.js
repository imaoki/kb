/*! © 2025 imaoki | MIT License | https://github.com/imaoki */
if(window.kb){const initModules={removeBlankParagraph(){const emptyParagraphs=document.querySelectorAll("p");kb.each(emptyParagraphs,paragraph=>{if(paragraph.childNodes.length===0){paragraph.remove();}});},moveTOC(){const tocElement=document.querySelector(".table-of-contents");const postMainElement=document.querySelector(".post.main");if(tocElement&&postMainElement){postMainElement.parentNode.insertBefore(tocElement,postMainElement);}},removeFootnoteSpaces(){const footnoteLinks=document.querySelectorAll("a[class*='reversefootnote']");kb.each(footnoteLinks,link=>{const parent=link.parentNode;if(parent){parent.innerHTML=parent.innerHTML.replace(/&nbsp;/g,"");}});},replaceTitle(){let headTitleContent="Untitled";const postMainH2Element=document.querySelector(".post.main > h2:first-of-type");if(postMainH2Element){headTitleContent=postMainH2Element.textContent;}
const titleElement=document.querySelector("head > title");if(titleElement){titleElement.textContent=headTitleContent;}
const postTitleLinkElement=document.querySelector(".post.title > a");if(postTitleLinkElement){postTitleLinkElement.textContent=headTitleContent;}
if(postMainH2Element){postMainH2Element.remove();}},replaceUpdatedDate(){const ddXPath="//main[contains(concat(' ', normalize-space(@class), ' '), ' post main ')]//dl[1]/dt[normalize-space(text()) = 'update']/following-sibling::dd[1]";const result=document.evaluate(ddXPath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(result.singleNodeValue){const ddElement=result.singleNodeValue;const timeElement=document.querySelector("time.date.updated");if(timeElement){timeElement.textContent=ddElement.textContent;const dlElement=ddElement.closest("dl");if(dlElement){dlElement.remove();}}}},addCodeInfoBlock(){const preElements=document.querySelectorAll("pre");const languagePattern=/.*\blanguage-(\w+)\b.*/;kb.each(preElements,pre=>{const codeElement=pre.querySelector("code");if(codeElement){const codeText=(codeElement.textContent||codeElement.innerText).trimEnd();const lines=codeText.split("\n");const lineCount=lines.length;if(lineCount>0){const maxDigits=String(lineCount).length;const lineNumbers=[];for(let i=1;i<=lineCount;i++){const currentLineNumber=String(i);const padding=" ".repeat(maxDigits-currentLineNumber.length);lineNumbers.push(padding+currentLineNumber);}
pre.setAttribute("data-line-number",lineNumbers.join("\n"));}
else{pre.setAttribute("data-line-number","");}
const className=codeElement.getAttribute("class")||"";const match=className.match(languagePattern);const language=match?match[1]:"text";const codeInfoBlock=document.createElement("ul");codeInfoBlock.className="code-info hlist between";const languageItem=document.createElement("li");languageItem.className="item language";languageItem.textContent=language;const copyItem=document.createElement("li");copyItem.className="item copy";const copyButton=document.createElement("span");copyButton.className="button icon copy";copyItem.appendChild(copyButton);codeInfoBlock.appendChild(languageItem);codeInfoBlock.appendChild(copyItem);pre.parentNode.insertBefore(codeInfoBlock,pre);copyButton.addEventListener("click",async()=>{const success=await kb.execCopy(codeText);if(success){copyButton.classList.add("success");setTimeout(()=>{copyButton.classList.remove("success");},1000);}
else{console.warn("コードのコピーに失敗しました:",codeText.substring(0,50)+"...");}});}});}};kb.addInitHandler(()=>{const initOrder=['removeBlankParagraph','moveTOC','removeFootnoteSpaces','replaceTitle','replaceUpdatedDate','addCodeInfoBlock'];initOrder.forEach(moduleName=>{try{initModules[moduleName]();}
catch(error){console.error(`${moduleName}の初期化でエラーが発生しました:`,error);}});});}
