/*! © 2025 imaoki | MIT License | https://github.com/imaoki */
if(window.kb){const initModules={highlightJs(){if(window.hljs){hljs.highlightAll();}},removeFootnoteSpaces(){const footnoteLinks=document.querySelectorAll("a[class*='reversefootnote']");kb.each(footnoteLinks,link=>{const parent=link.parentNode;if(parent){parent.innerHTML=parent.innerHTML.replace(/&nbsp;/g,"");}});},addCopyHandlers(){const copyElements=document.querySelectorAll("[data-kb-copy]");kb.each(copyElements,element=>{const textValue=element.getAttribute("data-kb-copy");if(textValue){element.addEventListener("click",async()=>{const success=await kb.execCopy(textValue);if(success){element.classList.add("success");setTimeout(()=>{element.classList.remove("success");},1000);}
else{console.warn("クリップボードへのコピーに失敗しました:",textValue);}});}});},addCodeInfoBlock(){const preElements=document.querySelectorAll("pre");const languagePattern=/.*\blanguage-(\w+)\b.*/;kb.each(preElements,pre=>{const codeElement=pre.querySelector("code");if(codeElement){const codeText=(codeElement.textContent||codeElement.innerText).trimEnd();const lines=codeText.split("\n");const lineCount=lines.length;if(lineCount>0){const maxDigits=String(lineCount).length;const lineNumbers=[];for(let i=1;i<=lineCount;i++){const currentLineNumber=String(i);const padding=" ".repeat(maxDigits-currentLineNumber.length);lineNumbers.push(padding+currentLineNumber);}
pre.setAttribute("data-line-number",lineNumbers.join("\n"));}
else{pre.setAttribute("data-line-number","");}
const className=codeElement.getAttribute("class")||"";const match=className.match(languagePattern);const language=match?match[1]:"text";const codeInfoBlock=document.createElement("ul");codeInfoBlock.className="code-info hlist between";const languageItem=document.createElement("li");languageItem.className="item language";languageItem.textContent=language;const copyItem=document.createElement("li");copyItem.className="item copy";const copyButton=document.createElement("span");copyButton.className="button icon copy";copyItem.appendChild(copyButton);codeInfoBlock.appendChild(languageItem);codeInfoBlock.appendChild(copyItem);pre.parentNode.insertBefore(codeInfoBlock,pre);copyButton.addEventListener("click",async()=>{const success=await kb.execCopy(codeText);if(success){copyButton.classList.add("success");setTimeout(()=>{copyButton.classList.remove("success");},1000);}
else{console.warn("コードのコピーに失敗しました:",codeText.substring(0,50)+"...");}});}});}};kb.addInitHandler(()=>{const initOrder=['highlightJs','removeFootnoteSpaces','addCopyHandlers','addCodeInfoBlock'];initOrder.forEach(moduleName=>{try{initModules[moduleName]();}
catch(error){console.error(`${moduleName}の初期化でエラーが発生しました:`,error);}});});}
